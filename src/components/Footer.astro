---
import { getBusinessInfo } from "../lib/sanity.js";
import { safeCmsUrl } from "../utils/url";

const business = await getBusinessInfo();
const businessName = business?.name || "Podologos Via Morelos Tulpetlac";
const phone = business?.phone || "";
const logoUrl = business?.logoImageUrl || "/default-logo-clinica.svg";

const facebookUrl = safeCmsUrl(business?.facebookUrl, "");
const instagramUrl = safeCmsUrl(business?.instagramUrl, "");
const tiktokUrl = safeCmsUrl(business?.tiktokUrl, "");

const menuTitle = business?.footerMenuTitle || "Menu";
const siteTitle = business?.footerSiteTitle || "Sobre el sitio";
const privacyUrl = safeCmsUrl(business?.footerPrivacyUrl, "/privacidad");
const noticesUrl = safeCmsUrl(business?.footerNoticesUrl, "/comunicados");
const copyrightText = business?.footerCopyrightText || "Todos los derechos reservados.";

const socialLinks = [
  { key: "facebook", label: "Facebook", url: facebookUrl },
  { key: "instagram", label: "Instagram", url: instagramUrl },
  { key: "tiktok", label: "TikTok", url: tiktokUrl },
];
---

<footer class="mt-12 bg-sky-900 text-sky-50">
  <div class="mx-auto max-w-6xl px-4 py-10">
    <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-4 lg:gap-10">
      <div class="sm:col-span-2 lg:col-span-1">
        <a href="/" class="inline-flex items-center gap-3">
          <img src={logoUrl} alt={businessName} class="h-10 w-auto rounded-md bg-white/10 p-1" loading="lazy" data-fallback-src="/default-logo-clinica.svg" />
          <span class="type-card-title leading-tight">{businessName}</span>
        </a>
        <p class="type-footer-body mt-3 text-sky-100">Atencion integral en podologia, psicologia, optica y quiropractica.</p>
        {phone && <p class="type-footer-body mt-2 text-sky-100">Tel: {phone}</p>}
      </div>

      <div>
        <h3 class="type-footer-title">{menuTitle}</h3>
        <ul class="type-footer-body mt-3 space-y-2">
          <li><a class="footer-link hover:underline" href="/">Inicio</a></li>
          <li><a class="footer-link hover:underline" href="/servicios">Nuestros servicios</a></li>
          <li><a class="footer-link hover:underline" href="/especialistas">Especialistas</a></li>
          <li><a class="footer-link hover:underline" href="/nosotros">Nosotros</a></li>
          <li><a class="footer-link hover:underline" href="/ubicacion">Ubicacion</a></li>
          <li><a class="footer-link hover:underline" href="/contacto">Contacto</a></li>
          <li><a class="footer-link hover:underline" href="/faq">FAQ</a></li>
        </ul>
      </div>

      <div>
        <h3 class="type-footer-title">{siteTitle}</h3>
        <ul class="type-footer-body mt-3 space-y-2">
          <li><a class="footer-link hover:underline" href={privacyUrl}>Aviso de privacidad</a></li>
          <li><a class="footer-link hover:underline" href={noticesUrl}>Comunicados</a></li>
        </ul>
      </div>

      <div>
        <h3 class="type-footer-title">Redes</h3>
        <div class="mt-3 flex flex-wrap gap-2">
          {socialLinks.map((social) => {
            const configured = Boolean(social.url);
            return (
              <a
                class={configured
                  ? "rounded-full bg-white/10 p-2 text-white hover:bg-white/20"
                  : "rounded-full bg-white/5 p-2 text-sky-200/50 cursor-not-allowed"}
                href={configured ? social.url : "#"}
                target={configured ? "_blank" : undefined}
                rel={configured ? "noopener noreferrer" : undefined}
                aria-label={social.label}
                title={configured ? social.label : `Configura ${social.label} en CMS > Ajustes generales > Redes`}
                aria-disabled={configured ? "false" : "true"}
                tabindex={configured ? "0" : "-1"}
              >
                {social.key === "facebook" && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor"><path d="M13 9h3V6h-3c-2.8 0-5 2.2-5 5v2H6v3h2v5h3v-5h3l1-3h-4v-2c0-1.1.9-2 2-2z"/></svg>}
                {social.key === "instagram" && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm10.5 1.5a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/></svg>}
                {social.key === "tiktok" && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor"><path d="M14 3c.4 1.7 1.8 3 3.5 3.2V9c-1.4-.1-2.6-.6-3.5-1.4V14a6 6 0 1 1-5.4-6v2.8a3.2 3.2 0 1 0 2.6 3.2V3H14z"/></svg>}
              </a>
            );
          })}
        </div>
      </div>
    </div>
  </div>

  <div class="border-t border-white/25">
    <div class="mx-auto grid max-w-6xl grid-cols-1 items-center gap-2 px-4 py-4 text-sky-100 md:grid-cols-[1fr_auto_1fr]">
      <p class="text-center text-xs font-medium tracking-wide text-sky-100/85 md:justify-self-start md:text-left">
        <a
          href="https://www.linkedin.com/in/ingabrahamjv/"
          target="_blank"
          rel="noopener noreferrer"
          class="underline-offset-2 hover:underline"
        >
          Sitio creado por ABJV
        </a>
      </p>
      <div class="type-footer-body flex items-center justify-center gap-2 text-center md:col-start-2 md:justify-self-center">
        <span class="text-center md:whitespace-nowrap">Copyright (c) {new Date().getFullYear()} {businessName} | {copyrightText}</span>
        <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-white/15" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4" fill="currentColor">
            <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2Zm-1 10h-4v4h-4v-4H6V9h4V5h4v4h4v4Z" />
          </svg>
        </span>
      </div>
      <div class="hidden md:block" aria-hidden="true"></div>
    </div>
  </div>
</footer>
